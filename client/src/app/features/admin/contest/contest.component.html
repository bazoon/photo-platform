<app-admin-layout>
  <h1>Конкурсы</h1>
  <button class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="append()">Добавить</button>
  <nz-table [nzData]="entities" [nzScroll]="{ x: '3200px', y: '240px' }">
    <thead>
      <tr>
        <th nzWidth="100px" nzLeft="0px"></th>
        <th nzWidth="200px">Salone</th>
        <th nzWidth="200px">Subname</th>
        <th nzWidth="200px">Years</th>
        <th nzWidth="200px">Date start</th>
        <th nzWidth="200px">Date stop</th>
        <th nzWidth="200px">Jury end</th>
        <th nzWidth="200px">Rate show</th>
        <th nzWidth="200px">Show type</th>
        <th nzWidth="200px">Show rate state</th>
        <th nzWidth="200px">Democraty</th>
        <th nzWidth="200px">Pay type</th>
        <th nzWidth="200px">Sections count</th>
        <th nzWidth="200px">Max rate</th>
        <th nzWidth="200px">Max size</th>
        <th nzWidth="200px">Max weight</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of entities" (click)="loadRelated(data.id)">
        <td style="cursor:pointer" nzLeft="0px">
          <i (click)="edit(data.id)" nz-icon nzType="edit" nzTheme="outline" style="margin-right: 10px"></i>
          <i nz-icon nzType="delete" nzTheme="outline" nz-popconfirm nzPopconfirmTitle="Удалить?" nzPopconfirmPlacement="top" (nzOnConfirm)="remove(data.id)"></i>
        </td>
        <td nzWidth="200px">{{data.salone}}</td>
        <td nzWidth="200px">{{data.subname}}</td>
        <td nzWidth="200px">{{data.years}}</td>
        <td nzWidth="200px">{{data.dateStart | date}}</td>
        <td nzWidth="200px">{{data.dateStop}}</td>
        <td nzWidth="200px">{{data.dateJuriEnd}}</td>
        <td nzWidth="200px">{{data.dateRateShow}}</td>
        <td nzWidth="200px">{{data.showType}}</td>
        <td nzWidth="200px">{{data.showRateState}}</td>
        <td nzWidth="200px">{{data.democraty}}</td>
        <td nzWidth="200px">{{data.payType}}</td>
        <td nzWidth="200px">{{data.sectionCount}}</td>
        <td nzWidth="200px">{{data.maxRate}}</td>
        <td nzWidth="200px">{{data.maxSize}}</td>
        <td nzWidth="200px">{{data.maxWeight}}</td>
      </tr>
    </tbody>
  </nz-table>

  <h1>О конкурсе</h1>

  <button [disabled]="!currentContest.id" class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="appendAbout()">Добавить</button>
  <nz-table [nzData]="abouts" [nzLoading]="isAboutsLoading" [nzScroll]="{ x: '700px', y: '240px' }">
    <thead>
      <tr>
        <th nzWidth="100px" nzLeft="0px"></th>
        <th nzWidth="200px">Name</th>
        <th nzWidth="200px">Language</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of abouts">
        <td style="cursor:pointer" nzLeft="0px">
          <i (click)="editAbout(data.id)" nz-icon nzType="edit" nzTheme="outline" style="margin-right: 10px"></i>
          <i nz-icon nzType="delete" nzTheme="outline" nz-popconfirm nzPopconfirmTitle="Удалить?" nzPopconfirmPlacement="top" (nzOnConfirm)="removeAbout(data.id)"></i>
        </td>
        <td>{{data.name}}</td>
        <td>{{data.language}}</td>
      </tr>
    </tbody>
  </nz-table>

  <h1>Меню публикаций</h1>
  <button [disabled]="!currentContest.id" class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="getLexicon(true)">Добавить</button>

  <nz-tree [nzData]="menuTree" [nzTreeTemplate]="nzTreeTemplate">
  </nz-tree>


  <ng-template #nzTreeTemplate let-node>
    <span>
      <nz-select [(ngModel)]="node.origin.lexiconId" style="width: 300px" (ngModelChange)="pubMenuLexiconChanged(node)">
        <nz-option *ngFor="let lexicon of lexicons" [nzValue]="lexicon.id" [nzLabel]="lexicon.code | translate"></nz-option>
      </nz-select>
      <button (click)="getLexicon(false, node)">
        <i nz-icon nzType="plus"></i>
      </button>
      <button (click)="editPubs(node)">
        <i nz-icon nzType="delete"></i>
      </button>

    </span>
    <!-- <span class="custom-node" [class.active]="activedNode?.key === node.key">
        <span *ngIf="!node.isLeaf" (contextmenu)="contextMenu($event, menu)">
          <i nz-icon [nzType]="node.isExpanded ? 'folder-open' : 'folder'" (click)="openFolder(node)"></i>
          <span class="folder-name">{{ node.title }}</span>
          <span class="folder-desc">created by {{ node?.origin?.author | lowercase }}</span>
        </span>
      </span> -->
  </ng-template>

  <!-- <button [disabled]="!currentContest.id" class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="appendMenu()">Добавить</button>
  <nz-table [nzData]="abouts" [nzLoading]="isMenusLoading" [nzScroll]="{ x: '700px', y: '240px' }">
    <thead>
      <tr>
        <th nzWidth="100px" nzLeft="0px"></th>
        <th nzWidth="200px">id</th>
        <th nzWidth="200px">Position</th>
        <th nzWidth="200px">Parent id</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of contestMenus">
        <td style="cursor:pointer" nzLeft="0px">
          <i (click)="editContestMenu(data.id)" nz-icon nzType="edit" nzTheme="outline" style="margin-right: 10px"></i>
          <i nz-icon nzType="delete" nzTheme="outline" nz-popconfirm nzPopconfirmTitle="Удалить?" nzPopconfirmPlacement="top" (nzOnConfirm)="removeAbout(data.id)"></i>
        </td>
        <td>{{data.id}}</td>
        <td>{{data.position}}</td>
        <td>{{data.parentId}}</td>
      </tr>
    </tbody>
  </nz-table> -->

  <nz-modal [(nzVisible)]="isEditVisible" nzTitle="Редактирование" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <form nz-form [formGroup]="form">
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="name">Salone</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-select formControlName="saloneId" nzAllowClear nzShowSearch="true">
            <nz-option *ngFor="let salone of salones" [nzValue]="salone.id" [nzLabel]="salone.name"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="subname">Sub name</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="subname" type="subname" id="subname" formControlName="subname">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="years">Years</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="years" type="years" id="years" formControlName="years">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="dateStart">Date start</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="dateStart"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="dateStop">Date stop</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="dateStop"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="dateJuriEnd">Jury end</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="dateJuriEnd"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="dateRateShow">Rate Show</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="dateRateShow"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="showType">ShowType</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="showType" type="showType" id="showType" formControlName="showType">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="showRateState">Show rate state</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="showRateState" type="showRateState" id="showRateState" formControlName="showRateState">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="democraty">Democraty</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="democraty" type="democraty" id="democraty" formControlName="democraty">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="payType">Pay type</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="payType" type="payType" id="payType" formControlName="payType">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="sectionCount">Section count</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="sectionCount" type="sectionCount" id="sectionCount" formControlName="sectionCount">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="maxrate">Max rate</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="maxrate" type="maxrate" id="maxrate" formControlName="maxrate">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="maxsize">Max size</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="maxsize" type="maxsize" id="maxsize" formControlName="maxsize">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="6" nzFor="maxWeight">Max weight</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <input nz-input name="maxWeight" type="maxWeight" id="maxWeight" formControlName="maxWeight">
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-modal>

  <nz-modal nzWidth="1000" [(nzVisible)]="isAboutVisible" nzTitle="Редактирование" (nzOnCancel)="handleCancelAbout()" (nzOnOk)="handleOkAbout()">
    <form nz-form [formGroup]="aboutForm">
      <nz-form-item>
        <nz-form-label nzFor="name">Name</nz-form-label>
        <nz-form-control>
          <input nz-input name="name" type="name" id="name" formControlName="name">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="language">Language</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="languageId" nzAllowClear nzPlaceHolder="Язык">
            <nz-option *ngFor="let language of languages" [nzValue]="language.id" [nzLabel]="language.name"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="thesis">Thesis</nz-form-label>
        <ckeditor formControlName="thesis" [editor]="Editor" [config]="ckconfig"></ckeditor>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="rules">Rules</nz-form-label>
        <ckeditor formControlName="rules" [editor]="Editor" [config]="ckconfig"></ckeditor>
      </nz-form-item>
    </form>
  </nz-modal>

  <nz-modal nzWidth="1000" [(nzVisible)]="isContestMenuVisible" nzTitle="Редактирование" (nzOnCancel)="handleCancelMenu()"
    (nzOnOk)="handleOkMenu()">
    <form nz-form [formGroup]="contestMenuForm">
      <nz-form-item>
        <nz-form-label nzFor="name">Position</nz-form-label>
        <nz-form-control>
          <input nz-input name="position" type="position" id="position" formControlName="position">
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="name">Parent Id</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="parentId" nzAllowClear nzPlaceHolder="Parent">
            <nz-option *ngFor="let menu of contestMenus" [nzValue]="menu.id" [nzLabel]="menu.id"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-modal>

  <nz-modal nzWidth="700" [(nzVisible)]="isPubsVisible" nzTitle="Редактирование" (nzOnCancel)="handleCancelPubs()" (nzOnOk)="handleOkPubs()">
    <button class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="appendPub()">Добавить</button>
    <button class="margin-top-small margin-bottom-small" nz-button nzType="primary" (click)="savePubs()">Сохранить</button>
    <nz-table [nzData]="menuPubs">
      <thead>
        <tr>
          <th nzWidth="100px" nzLeft="0px"></th>
          <th nzWidth="200px">Name</th>
          <th nzWidth="200px">Code</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of menuPubs">
          <td style="cursor:pointer" nzLeft="0px">
            <i (click)="editAbout(data.id)" nz-icon nzType="edit" nzTheme="outline" style="margin-right: 10px"></i>
            <i nz-icon nzType="delete" nzTheme="outline" nz-popconfirm nzPopconfirmTitle="Удалить?" nzPopconfirmPlacement="top" (nzOnConfirm)="removeAbout(data.id)"></i>
          </td>
          <td>
            <div class="editable-cell" *ngIf="pubEditId !== data.id; else editTpl">
              <div class="editable-cell-value-wrap" (click)="startEditPub(data.id, $event)">
                {{ data.name }}
              </div>
            </div>
            <ng-template #editTpl>
              <!-- <input type="text" nz-input [(ngModel)]="data.name" /> -->
              <nz-select [(ngModel)]="data.lexiconId" style="width:100%" nzAllowClear>
                <nz-option *ngFor="let lexicon of lexicons" [nzValue]="lexicon.id" [nzLabel]="lexicon.code | translate"></nz-option>
              </nz-select>
            </ng-template>
          </td>
          <td>{{data.code | translate}}</td>
        </tr>
      </tbody>
    </nz-table>
  </nz-modal>

  <nz-modal nzWidth="500" [(nzVisible)]="isLexiconVisible" nzTitle="Редактирование" (nzOnCancel)="handleCancelLexicon()" (nzOnOk)="handleOkLexicon()">
    <form nz-form [formGroup]="lexiconForm">
      <nz-form-item>
        <nz-form-label nzFor="name">Name</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="lexiconId" nzAllowClear>
            <nz-option *ngFor="let lexicon of lexicons" [nzValue]="lexicon.id" [nzLabel]="lexicon.code | translate"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-modal>
</app-admin-layout>